package Telefono;

import java.io.*;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

public class ServidorTelefono extends Thread{
	
	private Socket clientSocket;
	
	public ServidorTelefono(Socket socket){
		clientSocket = socket;
	}
	
	
	public void run() {
		try {
			System.out.println("Arrancando Hilo");
			
			InputStream iStream = clientSocket.getInputStream();
			OutputStream oStream = clientSocket.getOutputStream();
			BufferedReader bReader = new BufferedReader(new InputStreamReader(iStream));
			
			String mensaje = bReader.readLine();
			
			if(mensaje.compareToIgnoreCase("agenda")==0){
				//TODO: Enviar todo lo que haya en el TXT al cliente
				
			}else{
				//TODO: Guardar lo que nos llegue en el fichero TXT
				oStream.write("".getBytes());
				
			}
			
		} catch (Exception e) {
			
		}
	}
	
	public static void main(String args[]) throws IOException{
		
		File archivo = new File("telefonos.txt");
		FileReader fReader = new FileReader(archivo);
		FileWriter fWriter = new FileWriter(archivo);
		BufferedReader bReader = new BufferedReader(fReader);
		BufferedWriter bWriter = new BufferedWriter(fWriter);
		
		System.out.println("Iniciando el servidor");
		System.out.println("Esperando conexiones...");
		ServerSocket serverSocket = null;
		
		try {
			serverSocket = new ServerSocket();
			InetSocketAddress addr = new InetSocketAddress("192.168.26.41", 5555);
			serverSocket.bind(addr);
	
		} catch (IOException e) {
			e.printStackTrace();
		}
		
		System.out.println("Aceptando conexiones");
		
		while(serverSocket!=null){
			try {
				Socket newSocket = serverSocket.accept();
				System.out.println("Conexi√≥n recibida");
				
				ServidorTelefono hilo = new ServidorTelefono(newSocket);
				hilo.start();
			} catch (IOException e) {
				// TODO: handle exception
			}
		}
		
		System.out.println("Terminado");
	}

}
